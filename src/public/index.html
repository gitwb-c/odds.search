<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Odds ao Vivo</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #f4f4f6;
        --card: #ffffff;
        --text: #1a1a1e;
        --text-muted: #666666;
        --primary: #00d4aa;
        --border: #dddddd;
        --hover: #f0f0f0;
        --best: #00d4aa;
        --best-bg: rgba(0, 212, 170, 0.15);
        --favorite: #ffcc00;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg);
        color: var(--text);
        padding: 16px;
        line-height: 1.5;
        min-height: 100vh;
        font-size: 14px;
      }

      .container {
        max-width: 640px;
        margin: 0 auto;
      }

      h1 {
        font-size: 20px;
        font-weight: 700;
        text-align: center;
        margin-bottom: 16px;
        color: #000;
      }

      .tabs {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 16px;
      }

      .tab {
        background: var(--card);
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid var(--border);
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        display: flex;
        align-items: center;
      }

      .tab svg {
        width: 16px;
        height: 16px;
        margin-right: 4px;
      }

      .tab.active {
        background: var(--primary);
        color: #fff;
        border-color: var(--primary);
      }

      .search-bar {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        background: var(--card);
        padding: 10px;
        border-radius: 14px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      input {
        flex: 1;
        background: transparent;
        border: none;
        color: var(--text);
        font-size: 15px;
        outline: none;
        padding: 6px 0;
      }

      input::placeholder {
        color: var(--text-muted);
        font-size: 14px;
      }

      .dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--card);
        border-radius: 0 0 14px 14px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        max-height: 180px;
        overflow-y: auto;
        z-index: 10;
        display: none;
        border-top: 1px solid var(--border);
      }

      .dropdown.show {
        display: block;
      }

      .dropdown-item {
        padding: 10px 14px;
        cursor: pointer;
        border-bottom: 1px solid var(--border);
        transition: background 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
        color: #000; /* Ajuste para texto preto nas op√ß√µes de pesquisa */
      }

      .dropdown-item:hover,
      .dropdown-item.selected {
        background: var(--hover);
      }

      .dropdown-item .favorite-btn {
        width: 18px;
        height: 18px;
        opacity: 1;
        transition: opacity 0.2s;
      }

      .dropdown-item:last-child {
        border-bottom: none;
      }

      button {
        background: var(--primary);
        color: #000;
        border: none;
        padding: 0 16px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
        min-width: 80px;
        justify-content: center;
      }

      button:hover {
        background: #00e6bb;
        transform: translateY(-1px);
      }

      button .icon {
        width: 16px;
        height: 16px;
      }

      .favorites-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 16px;
      }

      .favorite-chip {
        background: var(--card);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 6px;
        border: 1px solid var(--border);
      }

      .favorite-chip .remove {
        width: 16px;
        height: 16px;
        cursor: pointer;
        opacity: 0.7;
      }

      .favorite-chip .remove:hover {
        opacity: 1;
      }

      #results {
        display: flex;
        flex-direction: column;
        gap: 14px;
      }

      .game {
        background: var(--card);
        border-radius: 14px;
        overflow: hidden;
        box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
      }

      .game:hover {
        transform: translateY(-1px);
      }

      .game-header {
        background: linear-gradient(135deg, #ffffff, #f0f0f0);
        padding: 12px 16px;
        font-weight: 600;
        font-size: 16px;
        color: #000;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .game-time {
        font-size: 12px;
        color: var(--text-muted);
        font-weight: 500;
      }

      .bookmaker-list {
        padding: 0 16px 12px;
      }

      .odds-header {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 12px 14px;
        border-bottom: 1px solid var(--border);
      }

      .sort-btn {
        background: #e0e0e0;
        color: var(--text);
        padding: 5px 8px;
        border-radius: 6px;
        min-width: 44px;
        text-align: center;
        border: none;
        cursor: pointer;
        font-weight: 700;
      }

      .sort-btn.active.asc::after {
        content: " ‚Üë";
        font-size: 10px;
      }

      .sort-btn.active.desc::after {
        content: " ‚Üì";
        font-size: 10px;
      }

      .bookmaker {
        background: #f0f0f0;
        margin-top: 10px;
        border-radius: 10px;
        padding: 12px 14px;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        border: 1px solid var(--border);
      }

      .bookmaker-name {
        font-weight: 600;
        color: #000;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 6px;
        flex: 1;
        min-width: 100px;
      }

      .bookmaker-logo {
        width: 20px;
        height: 20px;
        object-fit: contain;
      }

      .best-label {
        color: var(--best);
        font-size: 10px;
        font-weight: 700;
      }

      .odd-value {
        background: #e0e0e0;
        color: var(--text);
        padding: 5px 8px;
        border-radius: 6px;
        min-width: 44px;
        text-align: center;
        transition: all 0.2s;
        font-size: 14px;
        font-family: "Courier New", monospace;
        font-weight: 700;
      }

      .odd-value.best {
        background: var(--best-bg);
        color: var(--best);
        font-weight: 800;
        box-shadow: 0 0 6px rgba(0, 212, 170, 0.3);
      }

      .loading,
      .empty {
        text-align: center;
        padding: 24px;
        color: var(--text-muted);
        font-style: italic;
        font-size: 14px;
      }

      .refresh-info {
        text-align: center;
        font-size: 11px;
        color: var(--text-muted);
        margin-top: 12px;
      }

      /* Responsivo */
      @media (max-width: 480px) {
        body {
          padding: 12px;
        }
        h1 {
          font-size: 18px;
          margin-bottom: 12px;
        }
        .search-bar {
          padding: 8px;
          gap: 6px;
        }
        input {
          font-size: 14px;
        }
        button {
          padding: 0 12px;
          font-size: 13px;
        }
        .game-header {
          font-size: 15px;
          padding: 10px 14px;
        }
        .game-time {
          font-size: 11px;
        }
        .bookmaker {
          padding: 10px 12px;
          gap: 4px;
        }
        .sort-btn,
        .odd-value {
          font-size: 10px;
          padding: 4px 6px;
          min-width: 38px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Odds ao Vivo</h1>

      <div class="search-bar">
        <input id="search" type="text" />
        <div id="dropdown" class="dropdown"></div>
        <button id="btn">
          <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
            />
          </svg>
          Buscar
        </button>
      </div>

      <div id="favorites" class="favorites-list"></div>

      <div id="results"></div>
      <div class="refresh-info" id="refreshInfo">Busque para come√ßar</div>
    </div>

    <script>
      const searchInput = document.getElementById("search");
      const btn = document.getElementById("btn");
      const results = document.getElementById("results");
      const refreshInfo = document.getElementById("refreshInfo");
      const dropdown = document.getElementById("dropdown");
      const favoritesContainer = document.getElementById("favorites");

      const tabsContainer = document.createElement("div");
      tabsContainer.className = "tabs";
      tabsContainer.style.display = "none";
      document.querySelector(".search-bar").after(tabsContainer);

      let footballGames = [];
      let basketballGames = [];
      let activeSport = "football";

      const teamMapping = {
        "CA Paranaense PR": "Paranaense",
        "Atletico Mineiro MG": "Atletico",
        "EC Bahia BA": "Bahia",
        "Botafogo FR RJ": "Botafogo",
        "Red Bull Bragantino SP": "Bragantino",
        "Ceara SC CE": "Ceara",
        "SC Corinthians SP": "Corinthians",
        "Criciuma EC SC": "Criciuma",
        "Cruzeiro EC MG": "Cruzeiro",
        Cuiab√°: "Cuiaba",
        "CR Flamengo RJ": "Flamengo",
        "Fluminense FC RJ": "Fluminense",
        "Fortaleza EC CE": "Fortaleza",
        "Gremio FB Porto Alegrense RS": "Gremio",
        "SC Internacional RS": "Internacional",
        "EC Juventude RS": "Juventude",
        "Mirassol FC SP": "Mirassol",
        "SE Palmeiras SP": "Palmeiras",
        "Santos FC SP": "Santos",
        "Sao Paulo FC SP": "Sao Paulo",
        "CR Vasco da Gama RJ": "Vasco",
        "EC Vitoria BA": "Vitoria",
        "Goias EC GO": "Goias",
      };

      const bookmakerLogos = {
        betano:
          "https://www.nomadstudio.com/_next/image?url=https%3A%2F%2Fnomadstudio.ams3.digitaloceanspaces.com%2Fimages%2FLOGO.jpg&w=3840&q=75",
        bet365:
          "https://logos-world.net/wp-content/uploads/2024/10/Bet365-Logo.png",
        novibet:
          "https://seeklogo.com/images/N/novibet-logo-5B5E5E5E5E-seeklogo.com.png",
        stake:
          "https://www.gamingintelligence.com/wp-content/uploads/2023/01/Stake.jpg",
        superbet:
          "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Superbet_logo.png/330px-Superbet_logo.png",
      };

      const getLogo = (name) => {
        const normalized = name.toLowerCase().replace(".br", "").trim();
        return bookmakerLogos[normalized] || "";
      };

      let lastQuery = "";
      let intervalId = null;
      let selectedIndex = -1;
      let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");

      const saveFavorites = () => {
        localStorage.setItem("favorites", JSON.stringify(favorites));
        renderFavorites();
      };

      const renderFavorites = () => {
        favoritesContainer.innerHTML = "";
        if (favorites.length === 0) return;

        favorites.forEach((team) => {
          const chip = document.createElement("div");
          chip.className = "favorite-chip";
          chip.innerHTML = `
          <span>${team}</span>
          <svg class="remove" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        `;
          chip.querySelector(".remove").addEventListener("click", () => {
            favorites = favorites.filter((f) => f !== team);
            saveFavorites();
          });
          chip.addEventListener("click", () => {
            searchInput.value = team;
            search();
          });
          favoritesContainer.appendChild(chip);
        });
      };

      const toggleFavorite = (display) => {
        if (favorites.includes(display)) {
          favorites = favorites.filter((f) => f !== display);
        } else {
          favorites.push(display);
        }
        saveFavorites();
      };

      const populateDropdown = (filter = "") => {
        dropdown.innerHTML = "";
        const filtered = Object.keys(teamMapping).filter((display) =>
          display.toLowerCase().includes(filter.toLowerCase())
        );

        if (filtered.length === 0) {
          dropdown.classList.remove("show");
          return;
        }

        filtered.forEach((display, index) => {
          const isFav = favorites.includes(display);
          const item = document.createElement("div");
          item.className = "dropdown-item";
          item.innerHTML = `
          <span>${display}</span>
          <svg class="favorite-btn ${
            isFav ? "filled" : ""
          }" viewBox="0 0 24 24" fill="${
            isFav ? "var(--favorite)" : "none"
          }" stroke="currentColor" stroke-width="2">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        `;
          item.dataset.index = index;

          item.addEventListener("click", (e) => {
            if (e.target.closest(".favorite-btn")) {
              toggleFavorite(display);
              populateDropdown(searchInput.value.trim());
            } else {
              searchInput.value = display;
              dropdown.classList.remove("show");
              selectedIndex = -1;
              search();
            }
          });

          dropdown.appendChild(item);
        });

        dropdown.classList.add("show");
      };

      searchInput.addEventListener("input", (e) => {
        populateDropdown(e.target.value.trim());
        selectedIndex = -1;
      });

      searchInput.addEventListener("keydown", (e) => {
        const items = dropdown.querySelectorAll(".dropdown-item");
        if (items.length === 0) return;

        if (e.key === "ArrowDown") {
          e.preventDefault();
          selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
          updateSelection(items);
        } else if (e.key === "ArrowUp") {
          e.preventDefault();
          selectedIndex = Math.max(selectedIndex - 1, -1);
          updateSelection(items);
        } else if (e.key === "Enter" && selectedIndex >= 0) {
          e.preventDefault();
          const display =
            items[selectedIndex].querySelector("span").textContent;
          searchInput.value = display;
          dropdown.classList.remove("show");
          selectedIndex = -1;
          search();
        } else if (e.key === "Escape") {
          dropdown.classList.remove("show");
          selectedIndex = -1;
        }
      });

      const updateSelection = (items) => {
        items.forEach((item, i) => {
          item.classList.toggle("selected", i === selectedIndex);
        });
        if (selectedIndex >= 0) {
          items[selectedIndex].scrollIntoView({ block: "nearest" });
        }
      };

      document.addEventListener("click", (e) => {
        if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.classList.remove("show");
          selectedIndex = -1;
        }
      });

      const fmt = (val) => {
        if (val === undefined || val === null || val === "") return "-";
        const num = parseFloat(val);
        if (isNaN(num)) return "-";
        return num.toFixed(2);
      };

      const getBestHome = (gameOdds) => {
        let best = -Infinity;
        gameOdds.forEach((item) => {
          const home = parseFloat(item.odds.home);
          if (!isNaN(home) && home > best) best = home;
        });
        return best === -Infinity ? null : best;
      };

      const renderGame = (gameOdds) => {
        if (!gameOdds || gameOdds.length === 0) return null;

        const first = gameOdds[0];
        const hasDraw = first.sport === "football";

        let bestHome = -Infinity;
        let bestDraw = -Infinity;
        let bestAway = -Infinity;

        gameOdds.forEach((item) => {
          const h = parseFloat(item.odds.home);
          if (!isNaN(h) && h > bestHome) bestHome = h;
          if (hasDraw) {
            const d = parseFloat(item.odds.draw);
            if (!isNaN(d) && d > bestDraw) bestDraw = d;
          }
          const a = parseFloat(item.odds.away);
          if (!isNaN(a) && a > bestAway) bestAway = a;
        });

        const gameDiv = document.createElement("div");
        gameDiv.className = "game";
        gameDiv.dataset.sport = first.sport;
        gameDiv.dataset.gameOdds = JSON.stringify(gameOdds);
        gameDiv.dataset.sortCol = "none";
        gameDiv.dataset.sortDir = "desc";

        let bookmakersHTML = "";

        gameOdds.forEach((item) => {
          const homeVal = parseFloat(item.odds.home);
          const drawVal = hasDraw ? parseFloat(item.odds.draw) : NaN;
          const awayVal = parseFloat(item.odds.away);

          const isBestHome = !isNaN(homeVal) && homeVal === bestHome;
          const isBestDraw = hasDraw && !isNaN(drawVal) && drawVal === bestDraw;
          const isBestAway = !isNaN(awayVal) && awayVal === bestAway;

          const hasBest = isBestHome || isBestDraw || isBestAway;

          bookmakersHTML += `
            <div class="bookmaker">
              <div class="bookmaker-name">
                <img src="${getLogo(item.bookmaker)}" alt="${
            item.bookmaker
          }" class="bookmaker-logo">
                ${item.bookmaker}
                ${hasBest ? '<span class="best-label">Melhor</span>' : ""}
              </div>
              <div class="odd-value ${isBestHome ? "best" : ""}">${fmt(
            item.odds.home
          )}</div>
              ${
                hasDraw
                  ? `<div class="odd-value ${isBestDraw ? "best" : ""}">${fmt(
                      item.odds.draw
                    )}</div>`
                  : ""
              }
              <div class="odd-value ${isBestAway ? "best" : ""}">${fmt(
            item.odds.away
          )}</div>
            </div>
          `;
        });

        const date = new Date(first.date);
        const timeStr = date.toLocaleString("pt-BR", {
          day: "2-digit",
          month: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });

        gameDiv.innerHTML = `
          <div class="game-header">
            <div>${first.teams.home} √ó ${first.teams.away}</div>
            <div class="game-time">${timeStr}</div>
          </div>
          <div class="bookmaker-list">
            <div class="odds-header">
              <div class="bookmaker-name">&nbsp;</div>
              <button class="sort-btn" data-col="home">1</button>
              ${
                hasDraw
                  ? '<button class="sort-btn" data-col="draw">X</button>'
                  : ""
              }
              <button class="sort-btn" data-col="away">2</button>
            </div>
            ${bookmakersHTML}
          </div>
        `;

        gameDiv.addEventListener("click", (e) => {
          if (e.target.classList.contains("sort-btn")) {
            const col = e.target.dataset.col;
            const game = e.target.closest(".game");
            let dir = game.dataset.sortDir === "desc" ? "asc" : "desc";
            if (game.dataset.sortCol !== col) dir = "desc";
            game.dataset.sortCol = col;
            game.dataset.sortDir = dir;

            game.querySelectorAll(".sort-btn").forEach((b) => {
              b.classList.remove("active", "asc", "desc");
            });
            e.target.classList.add("active", dir);

            const odds = JSON.parse(game.dataset.gameOdds);
            odds.sort((a, b) => {
              let va = parseFloat(a.odds[col]);
              let vb = parseFloat(b.odds[col]);
              if (isNaN(va)) va = -Infinity;
              if (isNaN(vb)) vb = -Infinity;
              if (dir === "desc") return vb - va;
              return va - vb;
            });

            const hasDraw = game.dataset.sport === "football";

            let bestHome = -Infinity;
            let bestDraw = -Infinity;
            let bestAway = -Infinity;

            odds.forEach((item) => {
              const h = parseFloat(item.odds.home);
              if (!isNaN(h) && h > bestHome) bestHome = h;
              if (hasDraw) {
                const d = parseFloat(item.odds.draw);
                if (!isNaN(d) && d > bestDraw) bestDraw = d;
              }
              const a = parseFloat(item.odds.away);
              if (!isNaN(a) && a > bestAway) bestAway = a;
            });

            const list = game.querySelector(".bookmaker-list");
            while (list.children.length > 1) {
              list.lastChild.remove();
            }

            odds.forEach((item) => {
              const homeVal = parseFloat(item.odds.home);
              const drawVal = hasDraw ? parseFloat(item.odds.draw) : NaN;
              const awayVal = parseFloat(item.odds.away);

              const isBestHome = !isNaN(homeVal) && homeVal === bestHome;
              const isBestDraw =
                hasDraw && !isNaN(drawVal) && drawVal === bestDraw;
              const isBestAway = !isNaN(awayVal) && awayVal === bestAway;

              const hasBest = isBestHome || isBestDraw || isBestAway;

              const bookmakerDiv = document.createElement("div");
              bookmakerDiv.className = "bookmaker";
              bookmakerDiv.innerHTML = `
                <div class="bookmaker-name">
                  <img src="${getLogo(item.bookmaker)}" alt="${
                item.bookmaker
              }" class="bookmaker-logo">
                  ${item.bookmaker}
                  ${hasBest ? '<span class="best-label">Melhor</span>' : ""}
                </div>
                <div class="odd-value ${isBestHome ? "best" : ""}">${fmt(
                item.odds.home
              )}</div>
                ${
                  hasDraw
                    ? `<div class="odd-value ${isBestDraw ? "best" : ""}">${fmt(
                        item.odds.draw
                      )}</div>`
                    : ""
                }
                <div class="odd-value ${isBestAway ? "best" : ""}">${fmt(
                item.odds.away
              )}</div>
              `;
              list.appendChild(bookmakerDiv);
            });
          }
        });

        return gameDiv;
      };

      const sortGames = (games) => {
        return [...games].sort((a, b) => {
          const bestA = getBestHome(a);
          const bestB = getBestHome(b);
          return (bestB || 0) - (bestA || 0);
        });
      };

      const renderResults = () => {
        results.innerHTML = "";
        const games =
          activeSport === "football" ? footballGames : basketballGames;
        if (games.length === 0) {
          results.innerHTML =
            '<p class="empty">Nenhum jogo encontrado para este esporte.</p>';
          return;
        }
        const sorted = sortGames(games);
        sorted.forEach((gameOdds) => {
          const el = renderGame(gameOdds);
          if (el) results.appendChild(el);
        });
      };

      const createTab = (sport, label, svgPath) => {
        const tab = document.createElement("button");
        tab.className = "tab";
        tab.dataset.sport = sport;
        tab.innerHTML = `<svg viewBox="0 0 24 24" fill="currentColor">${svgPath}</svg> ${label}`;
        tab.addEventListener("click", () => {
          document
            .querySelectorAll(".tab")
            .forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");
          activeSport = sport;
          renderResults();
        });
        return tab;
      };

      const fetchAndRender = async (query) => {
        if (!query) return;
        lastQuery = query;

        results.innerHTML = '<p class="loading">...</p>';

        try {
          const res = await fetch(`/api/gateway/query`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ search: encodeURIComponent(query) }),
          });

          if (!res.ok) throw new Error("API indispon√≠vel");

          const data = await res.json();

          if (
            !data ||
            data.length === 0 ||
            data.every((arr) => !arr || arr.length === 0)
          ) {
            tabsContainer.style.display = "none";
            results.innerHTML = '<p class="empty">Nenhum jogo encontrado.</p>';
            return;
          }

          footballGames = data.filter(
            (gameOdds) => gameOdds[0] && gameOdds[0].sport === "football"
          );
          basketballGames = data.filter(
            (gameOdds) => gameOdds[0] && gameOdds[0].sport === "basketball"
          );

          if (footballGames.length > 0 || basketballGames.length > 0) {
            if (tabsContainer.children.length === 0) {
              const footballTab = createTab(
                "football",
                "Futebol",
                '<text x="0" y="20" font-size="20">‚öΩ</text>'
              );

              const basketballTab = createTab(
                "basketball",
                "Basquete",
                '<text x="0" y="20" font-size="20">üèÄ</text>'
              );
              tabsContainer.appendChild(footballTab);
              tabsContainer.appendChild(basketballTab);
            }
            tabsContainer.style.display = "flex";
            activeSport = footballGames.length > 0 ? "football" : "basketball";
            document
              .querySelectorAll(".tab")
              .forEach((t) => t.classList.remove("active"));
            document
              .querySelector(`.tab[data-sport="${activeSport}"]`)
              .classList.add("active");
            renderResults();
          } else {
            tabsContainer.style.display = "none";
            results.innerHTML = '<p class="empty">Nenhum jogo encontrado.</p>';
          }

          updateRefreshTime();
        } catch (err) {
          results.innerHTML = `<p class="loading">Erro: ${err.message}</p>`;
        }
      };

      let countdown = 60;
      const updateRefreshTime = () => {
        refreshInfo.textContent = `Atualiza em ${countdown}s`;
        countdown--;
        if (countdown < 0) countdown = 60;
      };

      const startAutoRefresh = () => {
        if (intervalId) clearInterval(intervalId);
        countdown = 60;
        updateRefreshTime();

        intervalId = setInterval(() => {
          updateRefreshTime();
          if (countdown === 0 && lastQuery) {
            fetchAndRender(lastQuery);
          }
        }, 1000);
      };

      const search = () => {
        const q = searchInput.value.trim();
        if (!q) return;
        const apiQuery = teamMapping[q] || q;
        fetchAndRender(apiQuery);
        startAutoRefresh();
      };

      btn.addEventListener("click", search);
      searchInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          search();
        }
      });

      renderFavorites();
    </script>
  </body>
</html>
